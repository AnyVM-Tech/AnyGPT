{
  "openapi": "3.1.0",
  "info": {
    "title": "AnyGPT API",
    "version": "1.0.0",
    "description": "AnyGPT API gateway for multiple model providers. This spec covers core endpoints and admin operations."
  },
  "servers": [
    {
      "url": "http://localhost:3000"
    }
  ],
  "paths": {
    "/openapi.json": {
      "get": {
        "summary": "Get OpenAPI spec",
        "responses": {
          "200": {
            "description": "OpenAPI document"
          }
        }
      }
    },
    "/v1/models": {
      "get": {
        "summary": "List models",
        "responses": {
          "200": {
            "description": "Model list"
          }
        }
      }
    },
    "/v1/chat/completions/models": {
      "get": {
        "summary": "List chat completion models",
        "responses": {
          "200": {
            "description": "Model list"
          }
        }
      }
    },
    "/v1/chat/completion/models": {
      "get": {
        "summary": "List chat completion models (alias)",
        "responses": {
          "200": {
            "description": "Model list"
          }
        }
      }
    },
    "/v1/keys/me": {
      "get": {
        "summary": "Get current API key details",
        "security": [
          {
            "BearerAuth": []
          },
          {
            "ApiKeyHeader": []
          }
        ],
        "responses": {
          "200": {
            "description": "Key details and usage",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "api_key_preview": {
                      "type": "string"
                    },
                    "api_key_hash": {
                      "type": "string"
                    },
                    "user": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string"
                        },
                        "role": {
                          "type": "string"
                        }
                      },
                      "required": [
                        "id",
                        "role"
                      ]
                    },
                    "tier": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string"
                        },
                        "limits": {
                          "type": "object"
                        }
                      },
                      "required": [
                        "id",
                        "limits"
                      ]
                    },
                    "usage": {
                      "type": "object",
                      "properties": {
                        "token_usage": {
                          "type": "integer"
                        },
                        "request_count": {
                          "type": "integer"
                        },
                        "remaining_tokens": {
                          "type": [
                            "integer",
                            "null"
                          ]
                        },
                        "max_tokens": {
                          "type": [
                            "integer",
                            "null"
                          ]
                        }
                      },
                      "required": [
                        "token_usage",
                        "request_count",
                        "remaining_tokens",
                        "max_tokens"
                      ]
                    },
                    "timestamp": {
                      "type": "string",
                      "format": "date-time"
                    }
                  },
                  "required": [
                    "api_key_preview",
                    "api_key_hash",
                    "user",
                    "tier",
                    "usage",
                    "timestamp"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized"
          }
        }
      }
    },
    "/admin/models/refresh-provider-counts": {
      "post": {
        "summary": "Refresh provider counts in models",
        "security": [
          {
            "BearerAuth": []
          },
          {
            "ApiKeyHeader": []
          }
        ],
        "responses": {
          "200": {
            "description": "Provider counts refreshed"
          }
        }
      }
    },
    "/api/admin/providers": {
      "post": {
        "summary": "Add or update provider",
        "security": [
          {
            "BearerAuth": []
          },
          {
            "ApiKeyHeader": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/AdminProviderPayload"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Provider processed"
          }
        }
      }
    },
    "/api/admin/users/generate-key": {
      "post": {
        "summary": "Generate API key",
        "security": [
          {
            "BearerAuth": []
          },
          {
            "ApiKeyHeader": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/AdminGenerateKeyPayload"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "API key generated"
          }
        }
      }
    },
    "/api/admin/keys": {
      "get": {
        "summary": "List logged admin keys",
        "security": [
          {
            "BearerAuth": []
          },
          {
            "ApiKeyHeader": []
          }
        ],
        "responses": {
          "200": {
            "description": "Key log entries"
          }
        }
      },
      "post": {
        "summary": "Log an admin key",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/AdminKeyIngestPayload"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Key logged"
          }
        }
      }
    },
    "/v1/chat/completions": {
      "post": {
        "summary": "Chat completions (OpenAI compatible)",
        "security": [
          {
            "BearerAuth": []
          },
          {
            "ApiKeyHeader": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "additionalProperties": true
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Chat completion"
          }
        }
      }
    },
    "/v1/responses": {
      "post": {
        "summary": "Responses API",
        "security": [
          {
            "BearerAuth": []
          },
          {
            "ApiKeyHeader": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "additionalProperties": true
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Response"
          }
        }
      }
    },
    "/v1/embeddings": {
      "post": {
        "summary": "Embeddings",
        "security": [
          {
            "BearerAuth": []
          },
          {
            "ApiKeyHeader": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "additionalProperties": true
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Embeddings"
          }
        }
      }
    },
    "/v1/interactions": {
      "post": {
        "summary": "Create interaction",
        "security": [
          {
            "BearerAuth": []
          },
          {
            "ApiKeyHeader": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "additionalProperties": true
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Interaction created"
          }
        }
      }
    },
    "/v1/interactions/{interactionId}": {
      "get": {
        "summary": "Get interaction",
        "security": [
          {
            "BearerAuth": []
          },
          {
            "ApiKeyHeader": []
          }
        ],
        "parameters": [
          {
            "name": "interactionId",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Interaction"
          }
        }
      }
    },
    "/v1/deployments/{deploymentId}/chat/completions": {
      "post": {
        "summary": "Chat completions (deployment)",
        "security": [
          {
            "BearerAuth": []
          },
          {
            "ApiKeyHeader": []
          }
        ],
        "parameters": [
          {
            "name": "deploymentId",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "additionalProperties": true
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Chat completion"
          }
        }
      }
    },
    "/v1/audio/speech": {
      "post": {
        "summary": "Text-to-speech",
        "security": [
          {
            "BearerAuth": []
          },
          {
            "ApiKeyHeader": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "additionalProperties": true
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Audio response"
          }
        }
      }
    },
    "/v1/audio/transcriptions": {
      "post": {
        "summary": "Audio transcription",
        "security": [
          {
            "BearerAuth": []
          },
          {
            "ApiKeyHeader": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "additionalProperties": true
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Transcription"
          }
        }
      }
    },
    "/v1/images/generations": {
      "post": {
        "summary": "Image generation",
        "security": [
          {
            "BearerAuth": []
          },
          {
            "ApiKeyHeader": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "additionalProperties": true
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Image generation"
          }
        }
      }
    },
    "/v1/videos/generations": {
      "post": {
        "summary": "Video generation",
        "security": [
          {
            "BearerAuth": []
          },
          {
            "ApiKeyHeader": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "additionalProperties": true
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Video generation"
          }
        }
      }
    },
    "/v1/videos/{requestId}": {
      "get": {
        "summary": "Video generation status",
        "security": [
          {
            "BearerAuth": []
          },
          {
            "ApiKeyHeader": []
          }
        ],
        "parameters": [
          {
            "name": "requestId",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Video status"
          }
        }
      }
    },
    "/v1/images/edits": {
      "post": {
        "summary": "Image edits",
        "security": [
          {
            "BearerAuth": []
          },
          {
            "ApiKeyHeader": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "additionalProperties": true
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Image edits"
          }
        }
      }
    },
    "/v1/audio/voices": {
      "get": {
        "summary": "List audio voices",
        "security": [
          {
            "BearerAuth": []
          },
          {
            "ApiKeyHeader": []
          }
        ],
        "responses": {
          "200": {
            "description": "Voices"
          }
        }
      }
    },
    "/v1/audio/models": {
      "get": {
        "summary": "List audio models",
        "security": [
          {
            "BearerAuth": []
          },
          {
            "ApiKeyHeader": []
          }
        ],
        "responses": {
          "200": {
            "description": "Audio models"
          }
        }
      }
    },
    "/v3/v3/messages": {
      "post": {
        "summary": "Anthropic messages",
        "security": [
          {
            "ApiKeyHeader": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "additionalProperties": true
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Anthropic response"
          }
        }
      }
    },
    "/v2/models/{modelId}/generateContent": {
      "post": {
        "summary": "Gemini generate content",
        "security": [
          {
            "BearerAuth": []
          },
          {
            "ApiKeyHeader": []
          }
        ],
        "parameters": [
          {
            "name": "modelId",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "additionalProperties": true
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Gemini response"
          }
        }
      }
    },
    "/v2/interactions": {
      "post": {
        "summary": "Gemini interactions",
        "security": [
          {
            "BearerAuth": []
          },
          {
            "ApiKeyHeader": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "additionalProperties": true
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Interaction created"
          }
        }
      }
    },
    "/v2/interactions/{interactionId}": {
      "get": {
        "summary": "Get Gemini interaction",
        "security": [
          {
            "BearerAuth": []
          },
          {
            "ApiKeyHeader": []
          }
        ],
        "parameters": [
          {
            "name": "interactionId",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Interaction"
          }
        }
      }
    },
    "/v4/v4/chat/completions": {
      "post": {
        "summary": "Groq chat completions",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "additionalProperties": true
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Chat completion"
          }
        }
      }
    },
    "/v5/v5/api/chat": {
      "post": {
        "summary": "Ollama chat",
        "security": [
          {
            "BearerAuth": []
          },
          {
            "ApiKeyHeader": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "additionalProperties": true
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Chat response"
          }
        }
      }
    },
    "/v6/v6/chat/completions": {
      "post": {
        "summary": "OpenRouter chat completions",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "additionalProperties": true
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Chat completion"
          }
        }
      }
    },
    "/ws": {
      "get": {
        "summary": "WebSocket endpoint",
        "description": "Upgrade to WebSocket for streaming chat.",
        "responses": {
          "101": {
            "description": "Switching Protocols"
          }
        }
      }
    },
    "/v1/realtime": {
      "get": {
        "summary": "Realtime WebSocket endpoint",
        "description": "Upgrade to WebSocket for realtime API.",
        "responses": {
          "101": {
            "description": "Switching Protocols"
          }
        }
      }
    },
    "/api/admin/api-keys": {
      "get": {
        "summary": "List API keys",
        "security": [
          {
            "BearerAuth": []
          },
          {
            "ApiKeyHeader": []
          }
        ],
        "parameters": [
          {
            "name": "role",
            "in": "query",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "tier",
            "in": "query",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "userId",
            "in": "query",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "API keys"
          }
        }
      }
    },
    "/api/admin/api-keys/revoke": {
      "post": {
        "summary": "Revoke API key",
        "security": [
          {
            "BearerAuth": []
          },
          {
            "ApiKeyHeader": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/AdminApiKeySelector" }
            }
          }
        },
        "responses": {
          "200": {
            "description": "API key revoked"
          }
        }
      }
    },
    "/api/admin/api-keys/reset-usage": {
      "post": {
        "summary": "Reset API key usage",
        "security": [
          {
            "BearerAuth": []
          },
          {
            "ApiKeyHeader": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/AdminApiKeySelector" }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Usage reset"
          }
        }
      }
    },
    "/api/admin/api-keys/update": {
      "post": {
        "summary": "Update API key",
        "security": [
          {
            "BearerAuth": []
          },
          {
            "ApiKeyHeader": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/AdminApiKeyUpdatePayload" }
            }
          }
        },
        "responses": {
          "200": {
            "description": "API key updated"
          }
        }
      }
    },
    "/api/admin/api-keys/rotate": {
      "post": {
        "summary": "Rotate API key",
        "security": [
          {
            "BearerAuth": []
          },
          {
            "ApiKeyHeader": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/AdminApiKeyRotatePayload" }
            }
          }
        },
        "responses": {
          "200": {
            "description": "API key rotated"
          }
        }
      }
    },
    "/api/admin/metrics/summary": {
      "get": {
        "summary": "Metrics summary",
        "security": [
          {
            "BearerAuth": []
          },
          {
            "ApiKeyHeader": []
          }
        ],
        "responses": {
          "200": {
            "description": "Metrics summary"
          }
        }
      }
    },
    "/api/admin/metrics/providers": {
      "get": {
        "summary": "Provider metrics",
        "security": [
          {
            "BearerAuth": []
          },
          {
            "ApiKeyHeader": []
          }
        ],
        "responses": {
          "200": {
            "description": "Provider metrics"
          }
        }
      }
    },
    "/api/admin/metrics/models": {
      "get": {
        "summary": "Model metrics",
        "security": [
          {
            "BearerAuth": []
          },
          {
            "ApiKeyHeader": []
          }
        ],
        "responses": {
          "200": {
            "description": "Model metrics"
          }
        }
      }
    }
  },
  "components": {
    "securitySchemes": {
      "BearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "API Key"
      },
      "ApiKeyHeader": {
        "type": "apiKey",
        "in": "header",
        "name": "x-api-key"
      }
    },
    "schemas": {
      "AdminProviderPayload": {
        "type": "object",
        "additionalProperties": false,
        "required": [
          "providerId",
          "providerBaseUrl"
        ],
        "properties": {
          "providerId": {
            "type": "string"
          },
          "providerBaseUrl": {
            "type": "string"
          },
          "apiKey": {
            "type": [
              "string",
              "null"
            ]
          }
        }
      },
      "AdminGenerateKeyPayload": {
        "type": "object",
        "additionalProperties": false,
        "required": [
          "userId"
        ],
        "properties": {
          "userId": {
            "type": "string"
          },
          "tier": {
            "type": "string"
          },
          "role": {
            "type": "string",
            "enum": [
              "admin",
              "user"
            ]
          }
        }
      },
      "AdminKeyIngestPayload": {
        "type": "object",
        "additionalProperties": false,
        "required": [
          "key",
          "provider"
        ],
        "properties": {
          "key": {
            "type": "string"
          },
          "provider": {
            "type": "string"
          },
          "tier": {
            "type": [
              "integer",
              "null"
            ]
          }
        }
      },
      "AdminApiKeySelector": {
        "type": "object",
        "additionalProperties": false,
        "properties": {
          "userId": {
            "type": "string"
          },
          "apiKey": {
            "type": "string"
          }
        },
        "anyOf": [
          { "required": ["userId"] },
          { "required": ["apiKey"] }
        ]
      },
      "AdminApiKeyUpdatePayload": {
        "type": "object",
        "additionalProperties": false,
        "properties": {
          "userId": {
            "type": "string"
          },
          "apiKey": {
            "type": "string"
          },
          "role": {
            "type": "string",
            "enum": [
              "admin",
              "user"
            ]
          },
          "tier": {
            "type": "string"
          }
        },
        "allOf": [
          { "anyOf": [{ "required": ["userId"] }, { "required": ["apiKey"] }] },
          { "anyOf": [{ "required": ["role"] }, { "required": ["tier"] }] }
        ]
      },
      "AdminApiKeyRotatePayload": {
        "type": "object",
        "additionalProperties": false,
        "properties": {
          "userId": {
            "type": "string"
          },
          "apiKey": {
            "type": "string"
          },
          "role": {
            "type": "string",
            "enum": [
              "admin",
              "user"
            ]
          },
          "tier": {
            "type": "string"
          }
        },
        "anyOf": [
          { "required": ["userId"] },
          { "required": ["apiKey"] }
        ]
      }
    }
  }
}
